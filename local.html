<html>
<head>
    <script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <script>
    window.pubHold = [];
    window.subHold = [];
    window.USBIp = window.USBIp || {
        publish: (ev) => { window.pubHold.push(ev); },
        subscribe: {
          connect: (ev) => { window.subHold.push(ev); }
        }
    };
    new QWebChannel(qt.webChannelTransport, (channel) => {
      const bridge = channel.objects.bridge;
      window.Bridge = bridge;
      window.USBIp = {
        publish: bridge.fromWeb,
        subscribe: bridge.toWeb
      };

      window.subHold.forEach(callback => {
        window.USBIp.subscribe.connect(callback);
      });
      window.pubHold.forEach(event => {
         window.USBIp.publish(event);
      });
      delete window.pubHold;
      delete window.subHold;
    });
    </script>
    <style>
       .bluebutton {
            background-color: #50d8dc;
            margin-right: 10px;
        }
        .fields {
            display: inline-block;
        }
    </style>
</head>
<body>
<script>
const monitorMessage = (message) => {
    window.monitor.appendChild(document.createTextNode(JSON.stringify(message)));
};
const doDelete = () => {
    const port = document.getElementById("port").value;
    USBIp.publish({'process': 'detach', port}, monitorMessage);
};
const doAttach = () => {
    const host = document.getElementById("host").value;
    const busid = document.getElementById("busid").value;
    USBIp.publish({
        'process': 'attach',
        host,
        busid
    }, monitorMessage);
};
const doList = () => {
    const host = document.getElementById("host").value;
    const result = USBIp.publish({
        'process': 'list',
        host
    }, monitorMessage);

};
const doPort = () => {
    USBIp.publish({"process": "port"}, monitorMessage);
};
</script>
<div>
<div class="fields">host: <input type="text" id="host" /></div>
<div class="fields">busId: <input type="text" id="busid" /></div>
<div class="fields">port: <input type="text" id="port" /></div>
</div>
<button onClick="doDelete();" class="bluebutton">Do Delete</button>
<button onClick="doAttach();" class="bluebutton">Do Attach</button>
<button onClick="doList();" class="bluebutton">Do List</button>
<button onClick="doPort();" class="bluebutton">Do Port</button>
<div id="monitor">
</div>
<script>
window.monitor = document.getElementById("monitor");
window.USBIp.subscribe.connect(console.log);
window.USBIp.subscribe.connect(monitorMessage);
</script>
</body>
</html>
